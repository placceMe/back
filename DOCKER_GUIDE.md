# ?? Docker Deployment Guide

## ??? ????????? ??????

- Docker ?? Docker Compose ???????????
- ??????? 8GB RAM
- ??????? 10GB ???????? ????? ?? ?????

## ?? ?????????? ??????

### Windows (PowerShell):
```powershell
.\test-docker-builds.ps1
```

### Linux/macOS (Bash):
```bash
chmod +x test-docker-builds.sh
./test-docker-builds.sh
```

## ?? ?????? ????? ???????

### 1. ?????? ?? ?????? ???? ????????:
```bash
docker-compose up --build
```

### 2. ?????? ? ???????? ??????:
```bash
docker-compose up -d --build
```

### 3. ???????? ?????:
```bash
# ??? ???????
docker-compose logs -f

# ?????????? ??????
docker-compose logs -f users-service
```

## ?? ???????? ??????? ????? ???????

| ?????? | URL | ???? |
|--------|-----|------|
| **NGINX Gateway** | http://localhost:8080 | ???????? entry point |
| **API Gateway** | http://localhost:5000 | .NET API Gateway (YARP) |
| **Users Service** | http://localhost:5002 | ?????????? ????????????? |
| **Products Service** | http://localhost:5003 | ?????????? ???????? |
| **Files Service** | http://localhost:5001 | ???????????? ?????? |
| **Chat Service** | http://localhost:5005 | ???? ?? ???????????? |
| **Orders Service** | http://localhost:5004 | ?????????? |
| **Notifications Service** | http://localhost:5007 | ??????????? |
| **PostgreSQL** | localhost:5432 | ???? ????? |
| **Redis** | localhost:6379 | ??? ?? ????? |
| **MinIO** | http://localhost:9000 | ??????? ??????? |
| **MinIO Console** | http://localhost:9001 | ???-????????? MinIO |
| **MailHog** | http://localhost:8025 | ?????????? email |

## ?? ?????????????? ?? ???????

### PostgreSQL:
- **Host:** localhost:5432
- **Database:** marketplace_db
- **Username:** marketplace
- **Password:** marketplace_password

### MinIO:
- **Access Key:** minioadmin
- **Secret Key:** minioadmin123

### Redis:
- **Host:** localhost:6379
- **No password**

## ?? ?????????? ????????????

### ??????? ???? ????????:
```bash
docker-compose down
```

### ??????? ? ?????????? volumes:
```bash
docker-compose down -v
```

### ?????????? ??????????? ???????:
```bash
docker-compose restart users-service
```

### ????????????? ???????:
```bash
docker-compose up -d --scale users-service=3
```

## ?? ???????????? ???????

### 1. ????????? ??????? ????????:
```bash
docker-compose ps
```

### 2. ????????? ??????:
```bash
docker network ls
docker network inspect marketplace_app-network
```

### 3. ????????? volumes:
```bash
docker volume ls
```

### 4. ???????? ???? Docker ????????:
```bash
# ?????: ???????? ??? Docker ???????!
docker system prune -a --volumes
```

### 5. ?????????? ??????????? ???????:
```bash
docker-compose build --no-cache users-service
docker-compose up -d users-service
```

## ?? ?????? ???????? ?? ???????

### ????????: "Port already in use"
```bash
# ?????? ??????, ?? ???????????? ????
netstat -tlnp | grep :5432
# ???
lsof -i :5432

# ???????? ??????
sudo kill -9 <PID>
```

### ????????: "No space left on device"
```bash
# ???????? unused images
docker image prune -a

# ???????? unused volumes
docker volume prune

# ???????? build cache
docker builder prune -a
```

### ????????: ???? ????? ?? ???????
```bash
# ????????? ????? PostgreSQL
docker-compose logs postgres-db

# ????????? volume ?? ??????????
docker-compose down -v
docker volume rm marketplace_postgres_data
docker-compose up -d postgres-db
```

### ????????: ?????? ?? ???? ???????????? ?? ??
1. ?????????, ?? PostgreSQL ?????????? (??????? health check)
2. ????????? connection strings ? docker-compose.yml
3. ????????? ???? ???????: `docker-compose logs <service-name>`

## ?? ????????? ?? ???????????

### Production deployment:
```bash
# ???????? production docker-compose
cp docker-compose.yml docker-compose.prod.yml

# ??????? environment variables
# ????????? ? production config
docker-compose -f docker-compose.prod.yml up -d --build
```

### Environment variables ??? production:
```bash
export ENVIRONMENT=Production
export DB_HOST=your-postgres-host
export REDIS_HOST=your-redis-host
export FRONTEND_URL=https://your-frontend.com
```

## ?? ??????????

### Health checks:
```bash
# ????????? ??????'? ???? ????????
docker-compose ps

# Health check ??????????? ???????
curl http://localhost:5002/health
```

### Metrics ?? ????:
- ??? ??????? ??????? ? PostgreSQL ????? Serilog
- Health endpoints ???????? ?? `/health` ??? ??????? ???????
- ????? ?????? Prometheus/Grafana ??? ???????????

## ?? ?????????? API

### ???????? ???????:

```bash
# ?????????? ???????????
curl -X POST http://localhost:5002/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"firstName":"John","lastName":"Doe","email":"john@example.com","password":"Password123"}'

# ???????????? ?????
curl -X POST http://localhost:5001/api/files/upload \
  -F "file=@image.jpg"

# ????????? ????????
curl -X POST http://localhost:5003/api/products \
  -H "Content-Type: application/json" \
  -d '{"title":"Test Product","description":"Test","price":100,"categoryId":"..."}'
```

## ?? ???????

### Development environment:
- ??? ?????? ?? ????? ? ?????????
- CORS ???????? ??? origins
- ????? HTTPS

### Production considerations:
- ??????? ??? ?????? ?? ?????
- ?????????? CORS ??? ?????????? ???????
- ??????? HTTPS/SSL
- ?????????? ????????
- ?????????????? secrets management

## ?? ????????? ???????

- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [PostgreSQL Docker Hub](https://hub.docker.com/_/postgres)
- [Redis Docker Hub](https://hub.docker.com/_/redis)
- [MinIO Documentation](https://docs.min.io/)